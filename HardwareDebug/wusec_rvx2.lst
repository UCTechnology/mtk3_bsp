   1                             		.file	"wusec_rvx2.c"
   2                             		.section P,"ax"
   3                             	.Ltext0:
   5                             	_wait_us:
   6                             	.LFB6:
   7                             		.file 1 "../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c"
   1:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** /*
   2:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *----------------------------------------------------------------------
   3:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *    micro T-Kernel 3.00.01
   4:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *
   5:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *    Copyright (C) 2006-2020 by Ken Sakamura.
   6:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *    This software is distributed under the T-License 2.2.
   7:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *----------------------------------------------------------------------
   8:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *
   9:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *    Released by TRON Forum(http://www.tron.org) at 2020/05/29.
  10:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *
  11:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *----------------------------------------------------------------------
  12:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  */
  13:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  14:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** #include <sys/machine.h>
  15:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** #ifdef CPU_CORE_RXV2
  16:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  17:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** /*
  18:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *	waitusec.c
  19:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *
  20:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  *	Micro Wait: Busy loop wait time in micro-sec (RXv2 Core)
  21:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c ****  */
  22:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  23:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** #include <tk/tkernel.h>
  24:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** #include <config.h>
  25:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  26:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** LOCAL void wait_us( UW usec )
  27:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** {
   8                             		.loc 1 27 1
   9 0000 7E AA                   		push.l	r10
  10                             	.LCFI0:
  11 0002 7E A6                   		push.l	r6
  12                             	.LCFI1:
  13 0004 71 0A E8                		add	#-24, r0, r10
  14                             	.LCFI2:
  15 0007 EF A0                   		mov.L	r10, r0
  16 0009 E7 A1 05                		mov.L	r1, 20[r10]
  28:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	UW	max, pre, cur, ofs, rem;
  29:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  30:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	max = *(_UH*)(CMT0_COR) + 1;
  17                             		.loc 1 30 8
  18 000c FB 5E 06 80 08          		mov.L	#0x88006, r5
  19 0011 DC 55                   		mov.W	[r5], r5
  20 0013 5F 55                   		movu.W	r5, r5
  21                             		.loc 1 30 26
  22 0015 62 15                   		add	#1, r5
  23                             		.loc 1 30 6
  24 0017 E7 A5 02                		mov.L	r5, 8[r10]
  31:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	rem = max * usec / (TIMER_PERIOD * 1000);
  25                             		.loc 1 31 12
  26 001a ED A4 02                		mov.L	8[r10], r4
  27 001d ED A5 05                		mov.L	20[r10], r5
  28 0020 4F 45                   		mul	r4, r5
  29                             		.loc 1 31 6
  30 0022 FB 42 59 17 B7 D1       		mov.L	#-776530087, r4
  31 0028 FC 1F 45                		emulu	r4, r5
  32 002b FD 8D 65                		shlr	#13, r6, r5
  33 002e E7 A5 01                		mov.L	r5, 4[r10]
  32:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  33:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	cur = *(_UH*)CMT0_CNT;
  34                             		.loc 1 33 8
  35 0031 FB 5E 04 80 08          		mov.L	#0x88004, r5
  36 0036 DC 55                   		mov.W	[r5], r5
  37                             		.loc 1 33 6
  38 0038 5F 55                   		movu.W	r5, r5
  39 003a E3 A5                   		mov.L	r5, [r10]
  40                             	.L6:
  34:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  35:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	for ( ;; ) {
  36:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		pre = cur;
  41                             		.loc 1 36 7
  42 003c EC A5                   		mov.L	[r10], r5
  43 003e E7 A5 03                		mov.L	r5, 12[r10]
  37:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		cur = *(_UH*)CMT0_CNT;
  44                             		.loc 1 37 9
  45 0041 FB 5E 04 80 08          		mov.L	#0x88004, r5
  46 0046 DC 55                   		mov.W	[r5], r5
  47                             		.loc 1 37 7
  48 0048 5F 55                   		movu.W	r5, r5
  49 004a E3 A5                   		mov.L	r5, [r10]
  38:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  39:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		ofs = (pre <= cur) ? (cur - pre) : (max + cur - pre);
  50                             		.loc 1 39 36
  51 004c ED A4 03                		mov.L	12[r10], r4
  52 004f EC A5                   		mov.L	[r10], r5
  53 0051 47 54                   		cmp	r5, r4
  54 0053 24 0C                   		bgtu	.L2
  55                             		.loc 1 39 36 is_stmt 0 discriminator 1
  56 0055 EC A4                   		mov.L	[r10], r4
  57 0057 ED A5 03                		mov.L	12[r10], r5
  58 005a FF 05 54                		sub	r5, r4, r5
  59 005d 2E 0D                   		bra	.L3
  60                             	.L2:
  61                             		.loc 1 39 43 is_stmt 1 discriminator 2
  62 005f ED A5 02                		mov.L	8[r10], r5
  63 0062 06 88 A5                		add	[r10].L, r5
  64                             		.loc 1 39 36 discriminator 2
  65 0065 ED A4 03                		mov.L	12[r10], r4
  66 0068 43 45                   		sub	r4, r5
  67                             	.L3:
  68                             		.loc 1 39 7 discriminator 4
  69 006a E7 A5 04                		mov.L	r5, 16[r10]
  40:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		if ( ofs >= rem ) {
  70                             		.loc 1 40 6 discriminator 4
  71 006d ED A4 04                		mov.L	16[r10], r4
  72 0070 ED A5 01                		mov.L	4[r10], r5
  73 0073 47 54                   		cmp	r5, r4
  74 0075 22 10                   		bgeu	.L8
  41:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 			break;
  42:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		}
  43:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		rem -= ofs;
  75                             		.loc 1 43 7
  76 0077 ED A4 01                		mov.L	4[r10], r4
  77 007a ED A5 04                		mov.L	16[r10], r5
  78 007d FF 05 54                		sub	r5, r4, r5
  79 0080 E7 A5 01                		mov.L	r5, 4[r10]
  36:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		cur = *(_UH*)CMT0_CNT;
  80                             		.loc 1 36 7
  81 0083 2E B9                   		bra	.L6
  82                             	.L8:
  41:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 			break;
  83                             		.loc 1 41 4
  84 0085 03                      		nop
  44:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	}
  45:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** }
  85                             		.loc 1 45 1
  86 0086 03                      		nop
  87 0087 71 00 18                		add	#24, r0
  88 008a 7E B6                   		pop	r6
  89 008c 7E BA                   		pop	r10
  90 008e 02                      		rts
  91                             	.LFE6:
  93                             		.global	_WaitUsec
  95                             	_WaitUsec:
  96                             	.LFB7:
  46:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  47:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** /* maximum time (in microseconds) that wait_us() can handle at a time */
  48:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** #define WAIT_US_STEP 10000
  49:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  50:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** EXPORT void WaitUsec( UW usec )
  51:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** {
  97                             		.loc 1 51 1
  98 008f 7E AA                   		push.l	r10
  99                             	.LCFI3:
 100 0091 71 0A FC                		add	#-4, r0, r10
 101                             	.LCFI4:
 102 0094 EF A0                   		mov.L	r10, r0
 103 0096 E3 A1                   		mov.L	r1, [r10]
  52:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	for ( ; usec >= WAIT_US_STEP; usec -= WAIT_US_STEP ) {
 104                             		.loc 1 52 2
 105 0098 2E 11                   		bra	.L10
 106                             	.L11:
  53:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		wait_us(WAIT_US_STEP);
 107                             		.loc 1 53 3 discriminator 2
 108 009a FB 1A 10 27             		mov.L	#0x2710, r1
 109 009e 39 62 FF                		bsr	_wait_us
  52:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	for ( ; usec >= WAIT_US_STEP; usec -= WAIT_US_STEP ) {
 110                             		.loc 1 52 37 discriminator 2
 111 00a1 EC A5                   		mov.L	[r10], r5
 112 00a3 72 55 F0 D8             		add	#-10000, r5
 113 00a7 E3 A5                   		mov.L	r5, [r10]
 114                             	.L10:
  52:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	for ( ; usec >= WAIT_US_STEP; usec -= WAIT_US_STEP ) {
 115                             		.loc 1 52 2 discriminator 1
 116 00a9 EC A5                   		mov.L	[r10], r5
 117 00ab 76 05 0F 27             		cmp	#0x270f, r5
 118 00af 24 EB                   		bgtu	.L11
  54:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	}
  55:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	wait_us(usec);
 119                             		.loc 1 55 2
 120 00b1 EC A1                   		mov.L	[r10], r1
 121 00b3 39 4D FF                		bsr	_wait_us
  56:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** }
 122                             		.loc 1 56 1
 123 00b6 03                      		nop
 124 00b7 3F AA 02                		rtsd	#8, r10-r10
 125                             	.LFE7:
 127                             		.global	_WaitNsec
 129                             	_WaitNsec:
 130                             	.LFB8:
  57:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 
  58:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** EXPORT void WaitNsec( UW nsec )
  59:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** {
 131                             		.loc 1 59 1
 132 00ba 7E AA                   		push.l	r10
 133                             	.LCFI5:
 134 00bc 7E A6                   		push.l	r6
 135                             	.LCFI6:
 136 00be 71 0A FC                		add	#-4, r0, r10
 137                             	.LCFI7:
 138 00c1 EF A0                   		mov.L	r10, r0
 139 00c3 E3 A1                   		mov.L	r1, [r10]
  60:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	for ( ; nsec >= (WAIT_US_STEP * 1000); nsec -= (WAIT_US_STEP * 1000) ) {
 140                             		.loc 1 60 2
 141 00c5 2E 13                   		bra	.L13
 142                             	.L14:
  61:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 		wait_us(WAIT_US_STEP);
 143                             		.loc 1 61 3 discriminator 2
 144 00c7 FB 1A 10 27             		mov.L	#0x2710, r1
 145 00cb 39 35 FF                		bsr	_wait_us
  60:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	for ( ; nsec >= (WAIT_US_STEP * 1000); nsec -= (WAIT_US_STEP * 1000) ) {
 146                             		.loc 1 60 46 discriminator 2
 147 00ce EC A5                   		mov.L	[r10], r5
 148 00d0 70 55 80 69 67 FF       		add	#-10000000, r5
 149 00d6 E3 A5                   		mov.L	r5, [r10]
 150                             	.L13:
  60:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	for ( ; nsec >= (WAIT_US_STEP * 1000); nsec -= (WAIT_US_STEP * 1000) ) {
 151                             		.loc 1 60 2 discriminator 1
 152 00d8 EC A5                   		mov.L	[r10], r5
 153 00da 74 05 7F 96 98 00       		cmp	#0x98967f, r5
 154 00e0 24 E7                   		bgtu	.L14
  62:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	}
  63:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** 	wait_us(nsec / 1000 + 1);
 155                             		.loc 1 63 15
 156 00e2 EC A4                   		mov.L	[r10], r4
 157 00e4 FB 52 D3 4D 62 10       		mov.L	#0x10624dd3, r5
 158 00ea FC 1F 45                		emulu	r4, r5
 159 00ed FD 86 65                		shlr	#6, r6, r5
 160                             		.loc 1 63 2
 161 00f0 62 15                   		add	#1, r5
 162 00f2 EF 51                   		mov.L	r5, r1
 163 00f4 39 0C FF                		bsr	_wait_us
  64:../lib/libtk/sysdepend/cpu/core/rxv2/wusec_rvx2.c **** }
 164                             		.loc 1 64 1
 165 00f7 03                      		nop
 166 00f8 62 40                   		add	#4, r0
 167 00fa 7E B6                   		pop	r6
 168 00fc 7E BA                   		pop	r10
 169 00fe 02                      		rts
 170                             	.LFE8:
 259                             	.Letext0:
 260                             		.file 2 "D:\\tkernel_dev\\mtk3_bsp\\dev_bsp_b2_rskrx65n\\include/tk/typedef.h"
